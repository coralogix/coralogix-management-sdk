syntax = "proto3";
package com.coralogixapis.database_catalog.v1;

import "google/protobuf/wrappers.proto";
import "com/coralogixapis/apm/common/v2/audit_log.proto";
import "com/coralogixapis/apm/common/v2/time_range.proto";
import "com/coralogixapis/database_catalog/v1/database.proto";
import "com/coralogixapis/database_catalog/v1/blueprints.proto";
import "com/coralogixapis/service_catalog/v1/repeated_widgets.proto";
import "com/coralogix/catalog/v1/common.proto";

import "com/coralogix/common/v1/audit_log.proto";
import "google/api/annotations.proto";
import "protoc-gen-openapiv2/options/annotations.proto";
import "google/api/http.proto";

message GetBlueprintsColumnsStreamRequest {
  option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
    json_schema: {
      title: "Get Blueprints Columns Stream Request"
      description: "This data structure represents a request to Blueprints Columns Stream."
      required: [
        "time_range",
        "database_name",
        "database_name_source",
        "database_system"
      ]
    }
    external_docs: {}
  };
  com.coralogixapis.apm.common.v2.TimeRange time_range = 1;
  google.protobuf.StringValue database_name = 2;
  google.protobuf.StringValue database_name_source = 3;
  google.protobuf.StringValue database_system = 4;
  repeated com.coralogix.catalog.v1.ApmFilter database_catalog_filters = 5;
  repeated google.protobuf.StringValue calling_services = 6;
  repeated google.protobuf.StringValue tables = 7;
}

message GetBlueprintsColumnsStreamResponse {
  option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
    json_schema: {
      title: "Get Blueprints Columns Stream Response"
      description: "This data structure represents a response to Blueprints Columns Stream."
      required: []
    }
    external_docs: {}
  };
  repeated BlueprintData blueprints = 1;
}


message GetBlueprintStatsRequest {
  option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
    json_schema: {
      title: "Get Blueprints Stats Request"
      description: "This data structure represents a request to Blueprints Stats."
      required: [
        "time_range",
        "database_name",
        "database_name_source",
        "database_system"
      ]
    }
    external_docs: {}
  };
  google.protobuf.StringValue database_name = 1;
  google.protobuf.StringValue database_name_source = 2;
  com.coralogixapis.apm.common.v2.TimeRange time_range = 3;
  repeated com.coralogix.catalog.v1.ApmFilter database_catalog_filters = 4;
  google.protobuf.StringValue database_system = 5;
  google.protobuf.StringValue table = 6;
  repeated google.protobuf.StringValue calling_services = 7;
  google.protobuf.StringValue blueprint = 8;
}

message GetBlueprintStatsResponse {
  option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
    json_schema: {
      title: "Get Blueprints Stats Response"
      description: "This data structure represents a response to Blueprints Stats."
      required: []
    }
    external_docs: {}
  };
  google.protobuf.UInt64Value avg_response_time = 1;
  google.protobuf.UInt64Value p95_response_time = 2;
  google.protobuf.UInt64Value p99_response_time = 3;
  google.protobuf.UInt64Value total_requests = 4;
  google.protobuf.UInt64Value total_failures = 5;
  google.protobuf.UInt64Value failure_percentage = 6;
}

message GetBlueprintGraphsStreamRequest{
  option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
    json_schema: {
      title: "Get Blueprints Graph Stream Request"
      description: "This data structure represents a request to Blueprints Graph Stream."
      required: [
        "time_range",
        "database_name",
        "database_name_source",
        "database_system"
      ]
    }
    external_docs: {}
  };
  google.protobuf.StringValue database_name = 1;
  google.protobuf.StringValue database_name_source = 2;
  com.coralogixapis.apm.common.v2.TimeRange time_range = 3;
  repeated com.coralogix.catalog.v1.ApmFilter database_catalog_filters = 4;
  google.protobuf.StringValue database_system = 5;
  google.protobuf.StringValue table = 6;
  repeated google.protobuf.StringValue calling_services = 7;
  google.protobuf.StringValue blueprint = 8;
}

message GetBlueprintGraphsStreamResponse{
  option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
    json_schema: {
      title: "Get Blueprints Graph Stream Response"
      description: "This data structure represents a response to Blueprints Graph Stream."
      required: []
    }
    external_docs: {}
  };
  oneof widget{
    com.coralogixapis.service_catalog.v1.RepeatedLineChart successes_and_failures = 1;
    com.coralogixapis.service_catalog.v1.RepeatedLineChart latency = 2;
  }
}

service BlueprintsService {
  rpc GetBlueprintsColumnsStream(GetBlueprintsColumnsStreamRequest) returns (stream GetBlueprintsColumnsStreamResponse) {
    option (google.api.http) = {
      get: "/v1/db-catalog/blueprints/columns",
    };
    option (com.coralogix.common.v1.audit_log_description).description = "get blueprints column stream";
  }
  rpc GetBlueprintStats(GetBlueprintStatsRequest) returns (GetBlueprintStatsResponse) {
    option (google.api.http) = {
      get: "/v1/db-catalog/blueprints/stats",
    };
    option (com.coralogix.common.v1.audit_log_description).description = "get blueprint stats";
  }
  rpc GetBlueprintGraphsStream(GetBlueprintGraphsStreamRequest) returns (stream GetBlueprintGraphsStreamResponse) {
    option (google.api.http) = {
      get: "/v1/db-catalog/blueprints/graphs",
    };
    option (com.coralogix.common.v1.audit_log_description).description = "get database blueprint graphs stream";
  }
}
