syntax = "proto3";

package com.coralogixapis.cases.v1;

import "com/coralogixapis/cases/v1/alert_indicator.proto";
import "com/coralogixapis/cases/v1/key_value.proto";
import "google/protobuf/timestamp.proto";
import "protoc-gen-openapiv3/options/annotations.proto";

message Case {
  option (grpc.gateway.protoc_gen_openapiv3.options.openapiv3_schema) = {
    json_schema: {
      title: "Case"
      description: "Represents a case within the Cases service."
      required: [
        "id",
        "title",
        "state",
        "status",
        "priority",
        "category",
        "create_time"
      ]
    }
  };
  string id = 1 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {
    description: "Unique identifier of the case"
    example: "\"3f166e9f-3c88-4af2-b52e-138f339dab3e\""
  }];
  string title = 2 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {
    description: "Case title"
    example: "\"Database outage investigation\""
  }];
  optional string description = 3 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {
    description: "Detailed description of the case"
    example: "\"Investigating DB connection errors in prod\""
  }];
  optional UserDetails assignee = 4 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {description: "Assigned user details"}];
  CaseState state = 5 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {
    description: "Current internal state of the case"
    example: "\"CASE_STATE_ACTIVE\""
  }];
  CaseStatus status = 6 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {
    description: "Current status of the case"
    example: "\"CASE_STATUS_ACKNOWLEDGED\""
  }];
  CasePriority priority = 7 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {
    description: "Priority of the case"
    example: "\"CASE_PRIORITY_P2\""
  }];
  CaseCategory category = 8 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {
    description: "Category of the case"
    example: "\"CASE_CATEGORY_AVAILABILITY\""
  }];
  google.protobuf.Timestamp create_time = 9 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {
    description: "When the case was created"
    example: "\"2025-09-22T10:30:00Z\""
  }];
  optional google.protobuf.Timestamp update_time = 10 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {description: "When the case was last updated"}];
  optional google.protobuf.Timestamp acknowledge_time = 11 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {description: "When the case was acknowledged"}];
  optional ResolutionDetails resolution_details = 12 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {description: "Resolution metadata"}];
  repeated KeyValue labels = 13 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {
    description: "User-defined labels for the case"
    example: "[{\\\"key\\\": \\\"team\\\", \\\"value\\\": \\\"backend\\\"}]"
  }];
  repeated KeyValue groupings = 14 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {description: "Grouping dimensions (e.g., service, subsystem)"}];
  PriorityDetails priority_details = 15 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {description: "System and override priority details"}];
  repeated AlertIndicator alert_indicators = 16 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {description: "List of alert indicators contributing to the case"}];
  optional string readable_id = 17 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {
    description: "Readable identifier of the case, available only for the cases that became Active"
    example: "\"CASE-123\""
  }];
}

enum CaseState {
  CASE_STATE_UNSPECIFIED = 0;
  CASE_STATE_CREATED = 1;
  CASE_STATE_ACTIVE = 2;
  CASE_STATE_RESOLVED = 3;
}

enum CaseStatus {
  CASE_STATUS_UNSPECIFIED = 0;
  CASE_STATUS_OPEN = 1;
  CASE_STATUS_ACKNOWLEDGED = 2;
  CASE_STATUS_CLOSED = 3;
}

enum CasePriority {
  CASE_PRIORITY_UNSPECIFIED = 0;
  CASE_PRIORITY_P1 = 1;
  CASE_PRIORITY_P2 = 2;
  CASE_PRIORITY_P3 = 3;
  CASE_PRIORITY_P4 = 4;
  CASE_PRIORITY_P5 = 5;
}

message PriorityDetails {
  option (grpc.gateway.protoc_gen_openapiv3.options.openapiv3_schema) = {
    json_schema: {
      title: "Priority details"
      description: "Priority details, including system computed and user override values."
    }
  };
  CasePriority system = 1 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {description: "System computed priority"}];
  optional CasePriority override = 2 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {description: "Optional override set by user"}];
}

enum CaseCategory {
  CASE_CATEGORY_UNSPECIFIED = 0;
  CASE_CATEGORY_SECURITY = 1;
  CASE_CATEGORY_AVAILABILITY = 2;
}

message UserDetails {
  option (grpc.gateway.protoc_gen_openapiv3.options.openapiv3_schema) = {
    json_schema: {
      title: "User details"
      description: "Minimal user identity information used in case assignments."
    }
  };
  string user_id = 1 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {
    description: "Unique user identifier"
    example: "\"3af152ee-9eaf-4803-87f1-23c5fb2fbaa0\""
  }];
}

message ResolutionDetails {
  option (grpc.gateway.protoc_gen_openapiv3.options.openapiv3_schema) = {
    json_schema: {
      title: "Resolution details"
      description: "Information about how and when a case was resolved."
    }
  };
  enum CaseResolver {
    CASE_RESOLVER_UNSPECIFIED = 0;
    CASE_RESOLVER_SYSTEM = 1;
    CASE_RESOLVER_USER = 2;
  }
  CaseResolver resolved_by = 1 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {
    description: "Entity that resolved the case"
    example: "\"CASE_RESOLVER_USER\""
  }];
  google.protobuf.Timestamp resolve_time = 2 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {
    description: "Timestamp when the case was resolved"
    example: "\"2025-09-22T11:15:00Z\""
  }];
}
