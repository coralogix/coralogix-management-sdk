syntax = "proto3";

package com.coralogixapis.cases.v1;

import "com/coralogixapis/cases/v1/case.proto";
import "google/protobuf/timestamp.proto";
import "protoc-gen-openapiv3/options/annotations.proto";

message CaseEvent {
  option (grpc.gateway.protoc_gen_openapiv3.options.openapiv3_schema) = {
    json_schema: {
      title: "Case event"
      description: "Represents an immutable entry in a case's event timeline."
      required: [
        "event_id",
        "event_data",
        "actor",
        "create_time",
        "event_time"
      ]
    }
  };
  string event_id = 1 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {
    description: "Unique identifier of the event"
    example: "\"ef51d3d9-a301-496b-aa7d-9a6e519ba0d5\""
  }];
  CaseEventData event_data = 2 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {description: "Event payload (assignment, comment, state/status change, etc.)"}];
  EventActor actor = 3 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {description: "Actor that produced the event (system or user)"}];
  google.protobuf.Timestamp create_time = 4 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {
    description: "Server-side insertion time"
    example: "\"2025-09-22T10:30:00Z\""
  }];
  google.protobuf.Timestamp event_time = 5 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {
    description: "Logical occurrence time of the event"
    example: "\"2025-09-22T10:29:45Z\""
  }];
  optional google.protobuf.Timestamp update_time = 6 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {description: "If edited, last modification time of the event"}];
}

message CaseEventData {
  option (grpc.gateway.protoc_gen_openapiv3.options.openapiv3_schema) = {
    json_schema: {
      title: "Case event data"
      description: "One-of wrapper for concrete case event types."
    }
  };
  oneof data {
    AssignedCaseEvent assigned = 1 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {description: "Case assigned to a user"}];
    UnassignedCaseEvent unassigned = 2 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {description: "Case unassigned from a user"}];
    CommentCaseEvent comment = 3 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {description: "User comment"}];
    ActivatedCaseEvent activated = 4 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {description: "Activated case event"}];
    StatusChangedCaseEvent status_changed = 5 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {description: "Status changed"}];
    NotificationSentCaseEvent notification_sent = 6 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {description: "Notification(s) sent"}];
    NotificationFailedCaseEvent notification_failed = 7 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {description: "Notification failure"}];
    CreatedCaseEvent created = 8 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {description: "Created case event"}];
    ResolvedCaseEvent resolved = 9 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {description: "Resolved case event"}];
    PriorityDetailsChangedCaseEvent priority_details_changed = 10 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {description: "Priority details changed case event"}];
  }
}

message CreatedCaseEvent {
  option (grpc.gateway.protoc_gen_openapiv3.options.openapiv3_schema) = {
    json_schema: {title: "Created event"}
  };
  CasePriority priority = 1 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {
    description: "Previous priority"
    example: "\"CASE_PRIORITY_P3\""
  }];
}

message AssignedCaseEvent {
  option (grpc.gateway.protoc_gen_openapiv3.options.openapiv3_schema) = {
    json_schema: {title: "Assigned event"}
  };
  string assignee_user_id = 1 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {
    description: "New assignee user ID"
    example: "\"3af152ee-9eaf-4803-87f1-23c5fb2fbaa0\""
  }];
  optional string previous_assignee_user_id = 2 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {description: "Previous assignee user ID (if any)"}];
}

message UnassignedCaseEvent {
  option (grpc.gateway.protoc_gen_openapiv3.options.openapiv3_schema) = {
    json_schema: {title: "Unassigned event"}
  };
  string previous_assignee_user_id = 1 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {description: "User ID that was unassigned"}];
}

message PriorityDetailsChangedCaseEvent {
  option (grpc.gateway.protoc_gen_openapiv3.options.openapiv3_schema) = {
    json_schema: {title: "Priority details changed event"}
  };
  PriorityDetails from = 1 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {description: "Previous priority details"}];
  PriorityDetails to = 2 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {description: "New priority details"}];
}

message CommentCaseEvent {
  option (grpc.gateway.protoc_gen_openapiv3.options.openapiv3_schema) = {
    json_schema: {title: "Comment event"}
  };
  string unsafe_text = 1 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {
    description: "Comment text"
    example: "\"Looking into DB timeouts\""
  }];
}

message ActivatedCaseEvent {
  option (grpc.gateway.protoc_gen_openapiv3.options.openapiv3_schema) = {
    json_schema: {title: "Activated case event"}
  };
}

message ResolvedCaseEvent {
  option (grpc.gateway.protoc_gen_openapiv3.options.openapiv3_schema) = {
    json_schema: {title: "Resolved case event"}
  };
  CaseState from = 1 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {
    description: "Previous state"
    example: "\"CASE_STATE_CREATED\""
  }];
  optional string reason = 2 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {
    description: "Resolution reason"
    example: "\"Case was not applicable.\""
  }];
}

message StatusChangedCaseEvent {
  option (grpc.gateway.protoc_gen_openapiv3.options.openapiv3_schema) = {
    json_schema: {title: "Status changed event"}
  };
  CaseStatus old_status = 1 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {
    description: "Previous status"
    example: "\"CASE_STATUS_OPEN\""
  }];
  CaseStatus new_status = 2 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {
    description: "New status"
    example: "\"CASE_STATUS_ACKNOWLEDGED\""
  }];
}

message NotificationSentCaseEvent {
  option (grpc.gateway.protoc_gen_openapiv3.options.openapiv3_schema) = {
    json_schema: {title: "Notification sent event"}
  };
  message NotificationMetadata {
    option (grpc.gateway.protoc_gen_openapiv3.options.openapiv3_schema) = {
      json_schema: {title: "Notification metadata"}
    };
    string token = 1 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {
      description: "Notification token/reference"
      example: "\"4c8ba1ec-acee-4bc7-ad6c-d35476b58541\""
    }];
  }
  repeated NotificationMetadata notifications = 1 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {description: "List of notifications produced by this action"}];
}

message NotificationFailedCaseEvent {
  option (grpc.gateway.protoc_gen_openapiv3.options.openapiv3_schema) = {
    json_schema: {title: "Notification failed event"}
  };
  string error = 2 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {
    description: "Error message for the failed notification"
    example: "\"Slack API: channel_not_found\""
  }];
}

message EventActor {
  option (grpc.gateway.protoc_gen_openapiv3.options.openapiv3_schema) = {
    json_schema: {
      title: "Event actor"
      description: "Actor that initiated the event."
    }
  };
  oneof actor {
    SystemActor system = 1 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {description: "System-generated event"}];
    UserActor user = 2 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {description: "User-generated event"}];
  }
}

message SystemActor {
  option (grpc.gateway.protoc_gen_openapiv3.options.openapiv3_schema) = {
    json_schema: {
      title: "System actor"
      description: "Empty message indicating system-initiated action."
    }
  };
}

message UserActor {
  option (grpc.gateway.protoc_gen_openapiv3.options.openapiv3_schema) = {
    json_schema: {
      title: "User actor"
      description: "Information about the user who initiated the action."
    }
  };
  string id = 1 [(grpc.gateway.protoc_gen_openapiv3.options.openapiv3_field) = {
    description: "User ID"
    example: "\"3af152ee-9eaf-4803-87f1-23c5fb2fbaa0\""
  }];
}
